// Switched from SQLite → PostgreSQL (Neon) for Vercel deployment
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")   // pooled URL (pgBouncer) — used by the app
  directUrl = env("DIRECT_URL")     // direct URL — used by prisma db push/migrate
}

generator client {
  provider = "prisma-client-js"
}

model Student {
  id        String    @id @default(cuid())
  name      String
  grade     Int       @default(4)
  createdAt DateTime  @default(now())
  progress  Progress[]
  attempts  Attempt[]
}

model Topic {
  id            String     @id
  name          String
  chapterNumber String
  questions     Question[]
  progress      Progress[]
}

model Question {
  id             String    @id
  topicId        String
  topic          Topic     @relation(fields: [topicId], references: [id])
  subTopic       String
  difficulty     String    // "Easy" | "Medium" | "Hard"
  questionText   String
  questionLatex  String    @default("")
  option1        String
  option2        String
  option3        String
  option4        String
  correctAnswer  String    // "A" | "B" | "C" | "D"
  hint1          String    @default("")
  hint2          String    @default("")
  hint3          String    @default("")
  stepByStep     String    @default("[]") // JSON string
  misconceptionA String    @default("")
  misconceptionB String    @default("")
  misconceptionC String    @default("")
  misconceptionD String    @default("")
  source         String    @default("hand_crafted")
  attempts       Attempt[]
}

model Progress {
  id        String   @id @default(cuid())
  studentId String
  student   Student  @relation(fields: [studentId], references: [id])
  topicId   String
  topic     Topic    @relation(fields: [topicId], references: [id])
  attempted Int      @default(0)
  correct   Int      @default(0)
  mastery   String   @default("NotStarted") // "NotStarted" | "Practicing" | "Mastered"
  updatedAt DateTime @updatedAt

  @@unique([studentId, topicId])
}

model Attempt {
  id          String   @id @default(cuid())
  studentId   String
  student     Student  @relation(fields: [studentId], references: [id])
  questionId  String
  question    Question @relation(fields: [questionId], references: [id])
  selected    String   // "A" | "B" | "C" | "D"
  isCorrect   Boolean
  hintUsed    Int      @default(0)
  timeTakenMs Int      @default(0)
  createdAt   DateTime @default(now())
}
